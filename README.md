# Nuclei Detection and Counting Tool

A computer vision-based tool for automated detection and counting of cell nuclei in microscopy images. This tool is designed to identify both circular and oval-shaped nuclei, handle overlapping structures, and distinguish between complete nuclei and those touching image borders. Currently, stable but is a work-in-progress and is only currently able to detect 20X images. Use at your own discretion.

---

## üîß Features

- Automated detection of cell nuclei in microscopy images
- **Shape classification**: Identifies both circular and oval-shaped nuclei
- **Overlap handling**: Merges overlapping small circles into ovals
- **Border detection**: Differentiates between complete nuclei and those touching image borders
- **Blue content verification**: Validates potential nuclei based on staining intensity
- **Scale bar removal**: Automatically excludes scale bars from analysis
- **Comprehensive visualization**: Color-coded results with detailed legend
- **Data export**: Results compiled into CSV for further analysis

---

## üì¶ Installation Requirements
### Python Compatibility

This project is compatible with **Python 3.6 and above**.

### ‚úÖ Requirements and Dependencies

Before running the project, ensure you have Python 3 installed. You can check your version with:

```bash
python --version
```

```bash
pip install opencv-python numpy pandas matplotlib scikit-image
```
Additionally, create two folders named "input" and "output".

## üìÇ Usage
**Place your input images in an input folder in the project directory.**

Supported Image Formats
TIFF (.tiff, .tif)
JPEG (.jpeg, .jpg)
PNG (.png)

Note, current version supports immumofluorescent images with nuclei labelled blue. Future releases will be include the ability to detect nuclei labelled with other colors such as green or red and ideally from immunohistochemical images.

To run the script:
```bash
python nuclei_detector.py
```
Results will be saved to the output folder: /n
Visualization images for each processed image
CSV file with nuclei counts

## ‚öôÔ∏è How It Works
### üîß Image Preprocessing
- Reads input image and detects/removes scale bar
- Converts to grayscale and applies thresholding
- Performs morphological operations to separate nuclei

### üîç Detection Process
- Uses Hough Circle Transform to detect circular nuclei
- Employs contour detection to identify oval-shaped nuclei
- Applies watershed algorithm for separating adjacent nuclei

### üß™ Classification
- Validates detected objects based on size and blue staining intensity
- Merges overlapping small circles into oval shapes
- Classifies objects as interior or border nuclei


### üé® Visualization
- Marks valid circular nuclei in green
- Marks valid oval nuclei in blue
- Marks border-touching nuclei in yellow (circles) or orange (ovals)
- Marks invalid detections in purple
- Provides count summary and color legend

## üìä Output Explanation
### üñºÔ∏è Visual Output
Each processed image generates a visualization showing:

The original image
Binary processed image
Color-coded detection results

### üìÑ CSV Output
The nuclei_counts_circles_ovals.csv file contains:

```bash
filename: Name of the processed image
nuclei_count: Count of valid nuclei not touching borders
border_nuclei_count: Count of nuclei touching image borders
circles_merged: Number of circles merged into ovals
ovals_from_circles: Number of ovals created from merged circles
total_valid: Total count of all detected valid nuclei. Overlapping small circles are counted as 1 nuclei.
```
## ‚öôÔ∏è Parameters

The code includes several configurable parameters:
```bash
BOTTOM_REGION = 0.40           # Fraction of image bottom to search for scale bar
MIN_WIDTH_FRAC = 0.05          # Minimum width fraction for scale bar detection
BLUE_THRESHOLD = 80            # Percentage threshold for blue content validation
SMALL_CIRCLE_RADIUS = 18       # Maximum radius for "small" circles
OVERLAP_THRESHOLD = 0.7        # Threshold for determining circle overlap
MIN_NUCLEUS_AREA = 200         # Minimum area for a valid nucleus
```

## Example 
<img width="2250" height="1050" alt="nuclei_circles_ovals_dapi_m jpg" src="https://github.com/user-attachments/assets/bf627af0-ee94-46b1-8dbb-bf0956c3b7ea" />
**Original** AI-generated (Microsoft Copilot) DAPI image.
**Binary** Image generated by thresholding the blurred grayscale channel (usually the blue channel for nuclei of the original) so that pixels are either 0 (black) or 255 (white).
**Detected Shapes** Merged images with green circles outlining nuclei.


### ‚ö†Ô∏è Limitations
- Optimized for histological images with blue-stained nuclei
- Performance may vary based on image resolution and staining quality
- May require parameter adjustments for different types of microscopy images

## üìÑ License
GPL-3.0
