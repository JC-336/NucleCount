# Nuclei Detection and Counting Tool

A computer vision-based tool for automated detection and counting of cell nuclei in microscopy images. This tool is designed to identify both circular and oval-shaped nuclei, handle overlapping structures, and distinguish between complete nuclei and those touching image borders. Currently stable, but still a work-in-progress. It currently supports only 20X magnification images.

---

## üîß Features

- Automated detection of cell nuclei in microscopy images
- **Shape classification**: Identifies both circular and oval-shaped nuclei
- **Overlap handling**: Merges overlapping small circles into ovals
- **Border detection**: Differentiates between complete nuclei and those touching image borders
- **Scale bar removal**: Automatically excludes scale bars from analysis
- **Comprehensive visualization**: Color-coded results with detailed legend
- **Data export**: Results compiled into CSV for further analysis

---

## üì¶ Installation Requirements
### Python Compatibility

This project is compatible with **Python 3.6 and above**.

### ‚úÖ Requirements and Dependencies

Before running the project, ensure Python 3 is installed.
```bash
python --version
```

```bash
pip install opencv-python numpy pandas matplotlib scikit-image
```
Additionally, create two folders named "input" and "output".

## üìÇ Usage
**Place your input images in an input folder in the project directory.**

Supported Image Formats
TIFF (.tiff, .tif)
JPEG (.jpeg, .jpg)
PNG (.png)

Note: the current version supports immunofluorescent images with nuclei labeled in blue.
To run the script:
```bash
python nuclei_detector.py
```
Results will be saved to the output folder:
Visualization images for each processed image
CSV file with nuclei counts

## ‚öôÔ∏è How It Works
### üîß Image Preprocessing
- Reads input image and detects/removes scale bar
- Converts to grayscale and applies thresholding
- Performs morphological operations to separate nuclei

### üîç Detection Process
- Uses Hough Circle Transform to detect circular nuclei
- Employs contour detection to identify oval-shaped nuclei
- Applies watershed algorithm for separating adjacent nuclei

### üß™ Classification
- Validates detected objects based on size and blue staining intensity
- Merges overlapping small circles into oval shapes
- Classifies objects as interior or border nuclei


### üé® Visualization
- Marks valid circular nuclei in green
- Marks valid oval nuclei in blue
- Marks border-touching nuclei in yellow (circles) or orange (ovals)
- Marks invalid detections in purple
- Provides count summary and color legend

## üìä Output Explanation
### üñºÔ∏è Visual Output
Each processed image generates a visualization showing:

The original image
Binary processed image
Color-coded detection results

## ‚öôÔ∏è Parameters

The code includes several configurable parameters:
```bash
BOTTOM_REGION = 0.40           # Fraction of image bottom to search for scale bar
MIN_WIDTH_FRAC = 0.05          # Minimum width fraction for scale bar detection
BLUE_THRESHOLD = 80            # Percentage threshold for blue content validation
SMALL_CIRCLE_RADIUS = 18       # Maximum radius for "small" circles
OVERLAP_THRESHOLD = 0.7        # Threshold for determining circle overlap
MIN_NUCLEUS_AREA = 200         # Minimum area for a valid nucleus
```

## Examples
<img width="2250" height="1050" alt="nuclei_circles_ovals_dapi_m jpg" src="https://github.com/user-attachments/assets/bf627af0-ee94-46b1-8dbb-bf0956c3b7ea" />

(Original) AI-generated (Microsoft Copilot) of DAPI-coloured nuclei.

(Binary) Image generated by thresholding the blurred grayscale channel (usually the blue channel for nuclei of the original) so that pixels are either 0 (black) or 255 (white).

(Detected Shapes) Merged images with green circles outlining nuclei with counted number in brackets.

<img width="2250" height="1050" alt="nuclei_circles_ovals_NT tif (green)_gray_to_blue png" src="https://github.com/user-attachments/assets/8c4abcf9-ceb8-4c09-af79-7bef1a1177a7" />

**Fluorescently stained telomerase-immortalized human aortic endothelial cells (teloHAECs).** Untreated teloHAECs were fixed with PFA and stained with DAPI as previously described (doi: 10.1016/j.jtha.2024.07.015). Green circles represent valid nuclei count. In contrast, yellow circles represent nuclei that are on the border of the image and are excluded from the count.



### ‚ö†Ô∏è Limitations
- Optimized for histological images with blue-stained nuclei
- Performance may vary based on image resolution and staining quality
- May require parameter adjustments for different types of microscopy images

## üìÑ License
GPL-3.0
